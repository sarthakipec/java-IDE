<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Online IDE</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Fira+Code&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs/loader.min.js"></script>
    <style>
        body {
    margin: 0;
    padding: 0;
    font-family: 'Roboto', sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background-color: #1a1a2e;
    color: #e0e0e0;
}

.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background-color: #16213e;
    color: #ad45e9;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.top-bar button, .top-bar select {
    margin-right: 15px;
    padding: 8px 15px;
    background-color: #0f3460;
    border: none;
    color: #e0e0e0;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.top-bar button:hover, .top-bar select:hover {
    background-color: #47131c;
    color: #ffffff;
}

.top-bar select {
    background-color: #0f3460;
}

#editor-container {
    display: flex;
    flex: 1;
    overflow: hidden;
    height: calc(100vh - 60px); /* Adjust this value as needed */
}

.editor-left, .editor-right {
    width: 50%;
    height: 100%;
    padding: 0;
    border-right: 1px solid #0f3460;
}

#output {
    height: 53%;
    background: #16213e;
    color: #e0e0e0;
    padding: 15px;
    overflow-y: auto;
    border: none;
    font-family: 'Fira Code', monospace;
    line-height: 1.6;
}

.tabs {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    background-color: #0f3460;
    color: #e0e0e0;
    overflow-x: auto;
    white-space: nowrap;
}

.tabs .tab {
    margin-right: 10px;
    padding: 8px 15px;
    background-color: #1a1a2e;
    border: none;
    color: #e0e0e0;
    cursor: pointer;
    border-radius: 5px 5px 0 0;
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
}

.tabs .tab:hover {
    background-color: #e94560;
    color: #ffffff;
}

.tabs .tab .close-btn, .tabs .tab .edit-btn, .tabs .tab .duplicate-btn {
    margin-left: 10px;
    font-size: 12px;
    opacity: 0.7;
    transition: opacity 0.3s ease;
}

.tabs .tab .close-btn:hover, .tabs .tab .edit-btn:hover, .tabs .tab .duplicate-btn:hover {
    opacity: 1;
}

.tabs .tab.active {
    background-color: #166bc6;
    color: #ffffff;
}

.add-tab-btn {
    margin-right: 10px;
    padding: 8px 15px;
    background-color: #0f3460;
    color: #e0e0e0;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.add-tab-btn:hover {
    background-color: #e94560;
    color: #ffffff;
}

.tabs::-webkit-scrollbar {
    height: 6px;
}

.tabs::-webkit-scrollbar-thumb {
    background-color: #e94560;
    border-radius: 3px;
}

.tabs::-webkit-scrollbar-track {
    background-color: #0f3460;
}

.editor-instance {
    width: 100%;
    height: 100%;
    display: none;
}

.editor-instance.active {
    display: block;
}

#input-container {
    display: flex;
    flex-direction: column;
    padding: 15px;
    background-color: #16213e;
    color: #e0e0e0;
}

#input-container textarea {
    width: 95%;
    height: 120px;
    margin-top: 10px;
    background-color: #1a1a2e;
    color: #e0e0e0;
    border: 1px solid #0f3460;
    padding: 10px;
    border-radius: 5px;
    font-family: 'Fira Code', monospace;
    resize: vertical;
    transition: all 0.3s ease;
}

#input-container textarea:focus {
    border-color: #e94560;
    outline: none;
    box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.2);
}

/* Add smooth transitions */
* {
    transition: all 0.3s ease;
}

/* Improve button and input focus styles */
button:focus, select:focus {
    outline: none;
    box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.5);
}

/* Remove the "Choose File" element */
input[type="file"] {
    display: none;
}

#input-container {
    display: flex;
    flex-direction: column;
}

.input-row {
    display: flex;
    margin-bottom: 10px;
}

.input-row input {
    flex-grow: 1;
    margin-right: 10px;
}

#terminal {
    height: 100%;
    background-color: #1e1e1e;
    color: #d4d4d4;
    font-family: 'Consolas', 'Courier New', monospace;
    padding: 10px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

#terminal-output {
    flex-grow: 1;
    white-space: pre-wrap;
    overflow-y: auto;
}

#terminal-input-line {
    display: flex;
    align-items: center;
}

#terminal-input {
    flex-grow: 1;
    background-color: transparent;
    border: none;
    color: #d4d4d4;
    font-family: inherit;
    font-size: inherit;
    outline: none;
}
    </style>
</head>
<body>
    <div class="top-bar">
        <div>
            <button onclick="runCode()">Run</button>
            <button onclick="debugCode()">Debug</button>
            <button onclick="saveAs()">Save As</button>
            <button onclick="openFile()">Open</button>
            <!-- Removed Java version select -->
        </div>
        <div>
            <select id="themeSelect" onchange="changeTheme(this.value)">
                <option value="vs-dark">Visual Studio Dark </option>
                <option value="vs">Visual Studio Light</option>
                <option value="hc-black">High Contrast Black</option>
                <option value="hc-light">High Contrast Light</option>
            </select>
            <select id="fontSelect" onchange="changeFont(this.value)">
                <option value="Roboto">Roboto</option>
                <option value="Courier New">Courier New</option>
                <option value="Monaco">Monaco</option>
                <option value="Open Sans">Open Sans</option>
                <option value="Lato">Lato</option>
                <option value="Montserrat">Montserrat</option>
                <option value="Poppins">Poppins</option>
                <option value="Merriweather">Merriweather</option>
                <option value="Source Sans Pro">Source Sans Pro</option>
                
            </select>
            <select id="fontSizeSelect" onchange="changeFontSize(this.value)">
                <option value="14">14</option>
                <option value="16">16</option>
                <option value="18">18</option>
                <option value="20">20</option>
            </select>
        </div>
    </div>

    <div class="tabs" id="tabs">
        <div class="tab active" id="tab-Main" onclick="switchTab('Main')">Main.java<span class="edit-btn" onclick="editTabName('Main', event)">✎</span><span class="duplicate-btn" onclick="duplicateTab('Main', event)">D</span><span class="close-btn" onclick="closeTab('Main', event)">X</span></div>
        <div class="add-tab-btn" onclick="addNewTab()">+</div>
    </div>

    <div id="editor-container">
        <div class="editor-left" id="editor-left">
            <div id="editor-Main" class="editor-instance active"></div>
        </div>
        <div class="editor-right">
            <div id="terminal">
                <div id="terminal-output"></div>
                <div id="terminal-input-line">
                    <span>> </span>
                    <input type="text" id="terminal-input" autofocus>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" class="hidden" accept=".java" onchange="loadFile(event)" />

    <script src="https://unpkg.com/monaco-editor/min/vs/loader.js"></script>
    <script>
        var currentTab = 'Main';
        var editors = {};
        var tabOrder = ['Main'];
        var tabDuplicateCount = {};
        var currentJavaVersion = '';
        let tabHighestCount = {};

        require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function () {
    createEditor('Main');
    populateThemes();
    populateJavaVersions();

    // Register snippets for Java based on your shortcuts
    monaco.languages.registerCompletionItemProvider('java', {
        provideCompletionItems: function (model, position) {
            var suggestions = [
                {
                    label: 'cast',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: '((SomeType) expr)',
                    documentation: 'Casts the expression to a new type'
                },
                {
                    label: 'else',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'if (!expr) {\n    // code\n}',
                    documentation: 'Creates a negated if statement'
                },
                {
                    label: 'for',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'for (T item : expr) {\n    // code\n}',
                    documentation: 'Creates a for statement'
                },
                {
                    label: 'fori',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'for (int i = 0; i < expr.length; i++) {\n    // code\n}',
                    documentation: 'Creates a for loop iterating over an array'
                },
                {
                    label: 'forr',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'for (int i = expr.length - 1; i >= 0; i--) {\n    // code\n}',
                    documentation: 'Creates a reverse for loop iterating over an array'
                },
                {
                    label: 'if',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'if (expr) {\n    // code\n}',
                    documentation: 'Creates an if statement'
                },
                {
                    label: 'nnull',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'if (expr != null) {\n    // code\n}',
                    documentation: 'Checks if the expression is not null'
                },
                {
                    label: 'null',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'if (expr == null) {\n    // code\n}',
                    documentation: 'Checks if the expression is null'
                },
                {
                    label: 'sysout',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'System.out.println(expr);',
                    documentation: 'Prints output to the console'
                },
                {
                    label: 'throw',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'throw new Exception("Error message");',
                    documentation: 'Throws an exception'
                },
                {
                    label: 'var',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'T name = expr;',
                    documentation: 'Creates a variable declaration'
                },
                {
                    label: 'while',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'while (expr) {\n    // code\n}',
                    documentation: 'Creates a while loop'
                },
                {
                    label: 'trycatch',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'try {\n    ${1:// code}\n} catch (${2:Exception e}) {\n    ${3:// exception handling}\n}',
                    documentation: 'Creates a try-catch block'
                },
                {
                    label: 'class',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'public class ${1:ClassName} {\n\n}',
                    documentation: 'Creates a class definition'
                },
                {
                    label: 'main',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'public static void main(String[] args) {\n    // code\n}',
                    documentation: 'Creates the main method'
                },
                {
                    label: 'switch',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'switch (expr) {\n    case value1:\n        // code\n        break;\n    case value2:\n        // code\n        break;\n    default:\n        // code\n}',
                    documentation: 'Creates a switch statement'
                },
                {
                    label: 'return',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'return value;',
                    documentation: 'Returns a value from a method'
                }

            ];

            return { suggestions: suggestions };
        }
    });
});


        function createEditor(tabId) {
            const editorElement = document.getElementById(`editor-${tabId}`);
            editors[tabId] = monaco.editor.create(editorElement, {
                value: `public class ${tabId} {\n    public static void main(String[] args) {\n        System.out.println("Hello, ${tabId}!");\n    }\n}`,
                language: 'java',
                theme: 'vs-dark',
                fontFamily: 'Consolas',
                fontSize: 14,
                automaticLayout: true,
                lineNumbers: 'on',
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                lineHeight: 20,
                padding: { top: 10 }
            });
        }

        function populateThemes() {
            const themes = ['vs', 'vs-dark', 'hc-black'];
            const themeSelect = document.getElementById('themeSelect');
            themes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme;
                option.textContent = theme;
                themeSelect.appendChild(option);
            });
        }

        function changeTheme(theme) {
            monaco.editor.setTheme(theme);
        }

        function changeFont(font) {
            Object.values(editors).forEach(editor => {
                editor.updateOptions({ fontFamily: font });
            });
        }

        function changeFontSize(size) {
            Object.values(editors).forEach(editor => {
                editor.updateOptions({ fontSize: parseInt(size) });
            });
        }

        let inputResolver = null;
        let isWaitingForInput = false;

        let currentProcess = null;

        async function runCode() {
            const code = editors[currentTab].getValue();
            const terminalOutput = document.getElementById('terminal-output');
            const terminalInput = document.getElementById('terminal-input');

            terminalOutput.innerHTML = '';
            terminalInput.value = '';

            try {
                const response = await fetch('http://localhost:3000/compile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code,
                        fileName: currentTab,
                    }),
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value, { stream: true });
                    terminalOutput.innerHTML += chunk;
                    terminalOutput.scrollTop = terminalOutput.scrollHeight;
                }
            } catch (error) {
                terminalOutput.innerHTML += `Error: ${error.message}\n`;
            }
        }

        document.getElementById('terminal-input').addEventListener('keypress', async function(e) {
            if (e.key === 'Enter') {
                const input = this.value;
                this.value = '';
                
                const terminalOutput = document.getElementById('terminal-output');
                terminalOutput.innerHTML += `${input}\n`;
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
                
                try {
                    const inputResponse = await fetch('http://localhost:3000/input', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ input }),
                    });
                    if (!inputResponse.ok) {
                        throw new Error('Failed to send input');
                    }
                } catch (error) {
                    terminalOutput.innerHTML += `Error: ${error.message}\n`;
                }
            }
        });

        async function debugCode() {
            const code = editors[currentTab].getValue();
            document.getElementById('output').innerText = 'Starting debug process...';

            try {
                const response = await fetch('http://localhost:3000/debug', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ code, fileName: currentTab }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.error) {
                    document.getElementById('output').innerText = `Debug Error: ${data.error}`;
                } else {
                    // Display debug output
                    document.getElementById('output').innerText = data.debugOutput;
                }
            } catch (error) {
                document.getElementById('output').innerText = `Debug Error: ${error.message}`;
            }
        }

        async function saveAs() {
            const code = editors[currentTab].getValue();
            
            try {
                // Ask user for save location and file name
                const handle = await window.showSaveFilePicker({
                    suggestedName: `${currentTab}.java`,
                    types: [{
                        description: 'Java Files',
                        accept: {'text/java': ['.java']},
                    }],
                });

                // Create a writable stream and write the content
                const writable = await handle.createWritable();
                await writable.write(code);
                await writable.close();

                // Update the current tab name to match the saved file
                const fileName = handle.name.replace('.java', '');
                updateTabName(currentTab, fileName);

            } catch (err) {
                if (err.name !== 'AbortError') {
                    console.error('Failed to save file:', err);
                    alert('Failed to save file. Please try again.');
                }
            }
        }

        function updateTabName(oldTabId, newTabId) {
            console.log(`Updating tab name from '${oldTabId}' to '${newTabId}'`);
            const tabElement = document.getElementById(`tab-${oldTabId}`);
            if (tabElement) {
                const displayName = `${newTabId}.java`;
                tabElement.id = `tab-${newTabId}`;
                tabElement.innerHTML = `${displayName}<span class="edit-btn" onclick="editTabName('${newTabId}', event)">✎</span><span class="duplicate-btn" onclick="duplicateTab('${newTabId}', event)">D</span><span class="close-btn" onclick="closeTab('${newTabId}', event)">X</span>`;
                tabElement.onclick = (event) => {
                    if (!event.target.classList.contains('edit-btn') && 
                        !event.target.classList.contains('duplicate-btn') && 
                        !event.target.classList.contains('close-btn')) {
                        switchTab(newTabId);
                    }
                };

                console.log(`Updating editors object`);
                editors[newTabId] = editors[oldTabId];
                delete editors[oldTabId];

                console.log(`Updating currentTab if necessary`);
                if (currentTab === oldTabId) {
                    currentTab = newTabId;
                }

                console.log(`Updating tabOrder`);
                const index = tabOrder.indexOf(oldTabId);
                if (index !== -1) {
                    tabOrder[index] = newTabId;
                }
                console.log('New tabOrder:', tabOrder);

                console.log(`Updating editor element id`);
                const editorElement = document.getElementById(`editor-${oldTabId}`);
                if (editorElement) {
                    editorElement.id = `editor-${newTabId}`;
                }

                // Update the Monaco Editor model
                const model = editors[newTabId].getModel();
                if (model) {
                    monaco.editor.setModelLanguage(model, 'java');
                    model.updateOptions({ tabSize: 4 });
                }
            } else {
                console.error(`Could not find tab element with id 'tab-${oldTabId}'`);
            }
        }

        function openFile() {
            document.getElementById('fileInput').click();
        }

        function loadFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    const fileName = file.name.replace('.java', '');
                    
                    // Check if a tab with the same name already exists
                    if (tabOrder.includes(fileName)) {
                        alert(`A file named "${fileName}.java" is already open. Please close it before opening this file.`);
                    } else {
                        addNewTab(fileName, content);
                    }
                };
                reader.readAsText(file);
            }
        }

        function addNewTab(tabId, content) {
            if (!tabId) {
                tabId = generateUniqueTabName('Class');
            }
            const displayName = tabId.endsWith('.java') ? tabId : `${tabId}.java`;

            // Update tabHighestCount when a new tab is added
            const [baseName, number] = tabId.split('_');
            if (number) {
                if (!tabHighestCount[baseName] || parseInt(number) > tabHighestCount[baseName]) {
                    tabHighestCount[baseName] = parseInt(number);
                }
            }

            const newTabDiv = document.createElement('div');
            newTabDiv.className = 'tab';
            newTabDiv.id = `tab-${tabId}`;
            newTabDiv.innerHTML = `${displayName}<span class="edit-btn" onclick="editTabName('${tabId}', event)">✎</span><span class="duplicate-btn" onclick="duplicateTab('${tabId}', event)">D</span><span class="close-btn" onclick="closeTab('${tabId}', event)">X</span>`;
            newTabDiv.onclick = () => switchTab(tabId);

            const plusBtn = document.querySelector('.add-tab-btn');
            plusBtn.insertAdjacentElement('beforebegin', newTabDiv);

            const newEditorDiv = document.createElement('div');
            newEditorDiv.id = `editor-${tabId}`;
            newEditorDiv.className = 'editor-instance';
            document.getElementById('editor-left').appendChild(newEditorDiv);

            createEditor(tabId);
            if (content) {
                editors[tabId].setValue(content);
            }

            tabOrder.push(tabId);
            switchTab(tabId);

            document.getElementById('tabs').scrollLeft = document.getElementById('tabs').scrollWidth;
        }

        function switchTab(tabId) {
            console.log(`Switching to tab: ${tabId}`);
            currentTab = tabId;
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');

            document.querySelectorAll('.editor-instance').forEach(editor => editor.style.display = 'none');
            document.getElementById(`editor-${tabId}`).style.display = 'block';

            editors[tabId].layout();
        }

        function closeTab(tabId, event) {
            event.stopPropagation();
            document.getElementById(`tab-${tabId}`).remove();
            const editorElement = document.getElementById(`editor-${tabId}`);
            if (editorElement) {
                editorElement.remove();
            }
            delete editors[tabId];
            tabOrder = tabOrder.filter(id => id !== tabId);

            // Update tabHighestCount when a tab is closed
            const [baseName, number] = tabId.split('_');
            if (number && tabHighestCount[baseName]) {
                // If this was the highest number, decrement it
                if (parseInt(number) === tabHighestCount[baseName]) {
                    tabHighestCount[baseName]--;
                }
            }

            if (tabOrder.length > 0) {
                switchTab(tabOrder[tabOrder.length - 1]);
            } else {
                addNewTab(); // Create a new tab if all tabs are closed
            }
        }

        function editTabName(tabId, event) {
            event.stopPropagation();
            const tabElement = document.getElementById(`tab-${tabId}`);
            const currentName = tabElement.childNodes[0].nodeValue.replace('.java', '');
            tabElement.innerHTML = `<input type="text" value="${currentName}" onblur="saveTabName('${tabId}', this)" onkeydown="handleTabNameKeydown(event, '${tabId}', this)" />`;
            tabElement.querySelector('input').focus();
        }

        function saveTabName(tabId, inputElement) {
            let newName = inputElement.value.trim();
            console.log(`Attempting to rename tab '${tabId}' to '${newName}'`);
            console.log('Current tabOrder:', tabOrder);

            if (newName && newName !== tabId) {
                // Remove .java extension if present
                newName = newName.replace(/\.java$/, '');
                
                console.log(`Checking if '${newName}' already exists`);
                if (tabOrder.some(tab => tab.toLowerCase() === newName.toLowerCase()) && newName.toLowerCase() !== tabId.toLowerCase()) {
                    console.log(`Tab name '${newName}' already exists`);
                    alert(`A file named "${newName}.java" already exists. Please choose a different name.`);
                    revertTabName(tabId);
                } else {
                    console.log(`Updating tab name from '${tabId}' to '${newName}'`);
                    updateTabName(tabId, newName);
                }
            } else {
                console.log(`Invalid new name or same as current name. Reverting.`);
                revertTabName(tabId);
            }
        }

        function revertTabName(tabId) {
            const tabElement = document.getElementById(`tab-${tabId}`);
            const displayName = `${tabId}.java`;
            tabElement.innerHTML = `${displayName}<span class="edit-btn" onclick="editTabName('${tabId}', event)">✎</span><span class="duplicate-btn" onclick="duplicateTab('${tabId}', event)">D</span><span class="close-btn" onclick="closeTab('${tabId}', event)">X</span>`;
        }

        function handleTabNameKeydown(event, tabId, inputElement) {
            if (event.key === 'Enter') {
                saveTabName(tabId, inputElement);
            }
        }

        function duplicateTab(tabId, event) {
            event.stopPropagation();
            const originalCode = editors[tabId].getValue();
            const originalClassName = tabId.split('_')[0]; // Get the base name without any numbers

            if (!tabHighestCount[originalClassName]) {
                tabHighestCount[originalClassName] = 0;
            }

            // Find the first available number
            let newNumber = 1;
            while (tabOrder.includes(`${originalClassName}_${newNumber}`)) {
                newNumber++;
            }

            // Update the highest count if necessary
            tabHighestCount[originalClassName] = Math.max(tabHighestCount[originalClassName], newNumber);

            const newTabId = `${originalClassName}_${newNumber}`;
            const newCode = originalCode.replace(new RegExp(`class\\s+${tabId.replace('_', '_?')}\\b`, 'g'), `class ${newTabId}`);

            addNewTab(newTabId, newCode);
        }

        function generateUniqueTabName(baseName) {
            let counter = 1;
            let newName = baseName;
            while (tabOrder.includes(newName)) {
                newName = `${baseName}${counter}`;
                counter++;
            }
            return newName;
        }

        function addInputField() {
            const inputContainer = document.getElementById('input-container');
            const newInputRow = document.createElement('div');
            newInputRow.className = 'input-row';
            newInputRow.innerHTML = `
                <input type="text" placeholder="Enter input">
                <button onclick="removeInputField(this)">-</button>
            `;
            inputContainer.appendChild(newInputRow);
        }

        function removeInputField(button) {
            button.parentElement.remove();
        }
    </script>
</body>
</html>